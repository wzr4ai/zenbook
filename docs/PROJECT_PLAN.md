# 中医推拿养生馆预约系统 - 项目规划总文档

## 1. 背景与目标
- **业务痛点**：电话预约效率低、易冲突，且无法追踪客户/技师数据。
- **解决方案**：构建一体化微信小程序，客户可自助预约，管理员可配置排班并实时干预。
- **核心成果**：
  1. 自助预约流程（地点/技师/服务 → 可用时段 → 提交预约）。
  2. 管理端在小程序中完成排班、定价、预约管理。
  3. 针对“父亲”角色的预约名额限制与并发控制逻辑。

## 2. 角色与使用场景
| 角色 | 入口 | 核心任务 |
| --- | --- | --- |
| 客户 Customer | 小程序主包 | 登录、维护就诊人、查看可约时间、预约/取消 |
| 技师 Technician | 管理分包 | 查看个人排班、维护例外、查看预约列表 |
| 管理员 Admin | 管理分包 | 全局配置 (技师/服务/地点/定价)、排班管理、手动预约 |

## 3. 范围与模块
- **客户端模块 (F-01 ~ F-10)**：账户、就诊人、服务浏览、预约流程、订单管理。
- **管理端模块 (B-01 ~ B-12)**：预约日历、手动预约、业务配置、排班、CRM。
- **后端模块**：Auth、Users、Catalog、Schedule、Appointments (详见 `docs/BACKEND.md`)。
- **数据库**：9 张核心表 + 关键约束（详见 `docs/DB.md`）。
- **API**：RESTful v1，按角色授权（详见 `docs/API.md`）。

## 4. 里程碑
| 阶段 | 目标 | 关键输出 |
| --- | --- | --- |
| Phase 1 - 管理 MVP | 后端 + 管理端上线，管理员可录入预约 | DB 初始化、后台 CRUD、管理员小程序分包 |
| Phase 2 - 客户预约 | 打通客户侧核心预约链路 | 可用时段计算、客户预约/取消、登录与就诊人 |
| Phase 3 - 上线与运维 | 稳定性、部署、审核 | 内测报告、部署手册、监控告警方案 |

## 5. 关键依赖与风险
- **复杂业务逻辑**：可用时间计算需串联 BusinessHours、ScheduleExceptions、Appointments、服务并发度与父亲限制。
- **统一入口**：前后端都需识别 `role` 并在 JWT 中携带，前端 store 与路由守卫同步更新。
- **数据一致性**：管理员创建预约必须绕过客户限额但遵守时间锁死；价格需在预约时写入 `price_at_booking`。

## 6. 文档矩阵与合并建议
| 文档 | 作用 | 关系 |
| --- | --- | --- |
| `PROJECT_PLAN.md` | 顶层范围、角色、里程碑、风险 | 统领其他文档 |
| `BACKEND.md` | 架构、模块边界、关键逻辑、测试建议 | 依赖 API & DB |
| `FRONTEND.md` | Uni-App 结构、状态、路由、页面职责 | 对接 API |
| `DB.md` | 表结构、约束、关系图文字说明 | 支撑业务逻辑 |
| `API.md` | 接口协议、鉴权、示例 | 连接前后端 |
| `docs/OPS_AND_TEST.md` |部署流程、环境变量、日志/监控、回滚步骤以及端到端测试清单。 | 测试 |
